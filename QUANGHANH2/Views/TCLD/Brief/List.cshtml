@{
    ViewData["Title"] = "List";
    Layout = "~/Views/Shared/_Layout_TCLD.cshtml";
}
<link href="~/dist/css/pages/data-table.css" rel="stylesheet">

@{
    ViewBag.Title = "Add";
    List<string> right = (List<string>)Session["RightIDs"];
}

<div class="col s12 m12 l12">
    <div class="card">
        <div class="card-content">
            <div class="row">
                <h3 class="center"><b>DANH SÁCH HỒ SƠ NHÂN VIÊN</b></h3>
                <hr>
                <div class="col s12 m12 l12">
                    <div class="row center">
                        <div class="col l3 m12 s12 input-field">
                            <input type="text" placeholder="Mã nhân viên" class='form-control autocomplete_MNV' id="searchMaNV" multiple />
                        </div>
                        <div class="col l3 m12 s12 input-field">
                            <input type="text" placeholder="Tên nhân viên" class='form-control autocomplete_Name' id="searchTenNV" multiple />
                        </div>
                        <div class="col l3 m12 s12 input-field">
                            <select class="form-control" id="searchGioiTinh">
                                <option value="" selected>Giới tính</option>
                                <option value="true">Nam</option>
                                <option value="false">Nữ</option>
                            </select>
                        </div>
                        <div class="col l3 m12 s12 input-field">
                            <button class="btn blue darken-2 btn-small" id="searchButton"><i class="fas fas fa-search"></i></button>
                        </div>
                    </div>
                </div>

                <div class="left col s12 m6 l6">
                    <div class="row">
                        <div class="col s12 m3 l3">
                            <a class="btn btn-small blue darken-2 modal-trigger input-field" data-target="tuyendung">Tuyển Dụng</a>
                        </div>
                        <div class="col s2 m3 l3">
                            <a class="btn btn-small blue darken-2 modal-trigger input-field" href="@Url.Content("/phong-tcld/quan-ly-nhan-vien/them-nhan-vien")">Thêm</a>
                        </div>
                        <div class="col s3 m3 l3">
                            <a class="btn btn-small blue darken-2 input-field" id="danhsachhosonhanvien"><i class="fas fa-file-excel"></i>&nbsp;Excel</a>
                        </div>
                    </div>
                </div>

                <div>

                    <div class="col s12 m12 l12 table-responsive">

                        <table id="test-table" class="tcld table-bordered mytablr" style="width:100%; margin-top: 20px; max-height:600px!important">
                            <thead>
                                <tr>
                                    <th>
                                        Mã nhân viên
                                    </th>
                                    <th>
                                        Tên nhân viên
                                    </th>
                                    <th>
                                        Ngày sinh
                                    </th>
                                    <th>
                                        Giới tính
                                    </th>
                                    <th>
                                        Số điện thoại
                                    </th>
                                    <th>
                                        Tên phân xưởng
                                    </th>
                                    <th>
                                        Trạng thái làm việc
                                    </th>
                                    <th>
                                    </th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <br />
        </div>
    </div>
</div>

<ul id='dropdown' class='dropdown-content'>
    <li><a href="@Url.Content("/phong-tcld/quan-ly-nhan-vien/lich-su-lam-viec")" class="black-text">Làm việc</a></li>
    <li class="divider" tabindex="-1"></li>
    <li><a href="@Url.Content("/phong-tcld/quan-ly-nhan-vien/chi-tiet-dieu-chuyen")" class="black-text">Điều chuyển</a></li>
</ul>

<div id="deleteBriefs" class="modal open">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Xác nhận thanh lý hợp đồng</h3>
        </div>
        <form action="/delete" method="post">

            <div class="modal-body">
                <p class="red-text">Lý do thanh lý hợp đồng?</p>
                <div class="row">
                    <div class="col s12 m12 l12">
                        <label>Số quyết định</label>
                        <input name="soQD" type='text' class='center form-control' placeholder="Số quyết định" />
                    </div>

                    <div class="col s6 m6 l6">
                        <label>Lí do chấm dứt</label>
                        <select name="lydo" class="form-control" id="tlhd" onchange="onSelectTypeOfEndContract()">
                            <option value="Đi học">Đi học</option>
                            <option value="Hưu trí">Hưu trí</option>
                            <option value="Xin chấm dứt HĐLĐ, thôi việc">Xin chấm dứt HĐLĐ, thôi việc</option>
                            <option value="Sa thải">Sa thải</option>
                            <option value="Đơn phương chấm dứt HĐLĐ, bỏ việc">Đơn phương chấm dứt HĐLĐ, bỏ việc</option>
                            <option value="Đi nghĩa vụ quân sự">Đi nghĩa vụ quân sự</option>
                            <option id="dvn" value="Đi đơn vị ngoài">Đi đơn vị ngoài</option>
                            <option value="Ốm chết rủi ro">Ốm chết rủi ro</option>
                            <option value="Chết do tai nạn lao động">Chết do tai nạn lao động</option>
                            <option id="khac" value="Các trường hợp khác">Các trường hợp khác</option>
                        </select>
                    </div>
                    <div class="col s6 m6 l6">
                        <label>Ngày chấm dứt</label>
                        <input name="date" type='text' class='datepicker-here center form-control' data-language='vi' value="dd/mm/yyyy" />
                    </div>

                </div>
                <div class="row">
                    <div id="containerOption1" class="col s6 m6 l6" style="display: none">
                        <label>
                            <input name="group1" type="radio" checked />
                            <span>Đi các đơn vị trong TKV</span>
                        </label>
                        <label>
                            <input name="group1" type="radio" />
                            <span>Đi các đơn vị ngoài TKV</span>
                        </label>
                    </div>
                    <div id="containerOption2" class="col s6 m6 l6" style="display: none">
                        <label>
                            <input name="group2" type="radio" checked />
                            <span>Hết hạn HĐLĐ</span>
                        </label>
                        <br />
                        <label>
                            <input name="group2" type="radio" />
                            <span>Trường hợp khác</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" onclick="getOne()" value="" class="btn blue darken-2 modal-close">Xác nhận</button>
                <input type="hidden" id="tlhdd" />
                <button type="button" class="btn blue darken-2 modal-close">Hủy</button>
            </div>
        </form>
    </div>
</div>

<div id="tuyendung" class="modal">
    <div class="modal-content">
        Nhập từ excel
        <br />
        Bấm oke sẽ ra màn hình load dữ liệu, từ màn hình đó bấm Xác Nhận thì insert db.
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Done</a>
    </div>
</div>

<div id="history" class="modal open">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Chuyển đến</h3>
        </div>
        <div class="modal-body row">
            <div class="col l6 m6 s6 center">
                <a href="@Url.Content("/phong-tcld/quan-ly-nhan-vien/lich-su-lam-viec")" class="waves-light btn blue darken-2 btn-small">Lịch sử làm việc</a>
            </div>
            <div class="col l6 m6 s6 center">
                <a href="@Url.Content("/phong-tcld/quan-ly-nhan-vien/chi-tiet-dieu-chuyen")" class="waves-effect waves-light btn blue darken-2 btn-small">Điều chuyển</a>
            </div>
        </div>
    </div>
</div>

<script src="~/js/Custom JS/TCLD/Brief/Briefs_List.js"></script>
<script src="~/js/advancedsearch/advancedsearch.js"></script>
<script src="~/js/Custom JS/form-input-border.js"></script>
<link href="~/css/advancedsearch/advancedsearch.css" rel="stylesheet" />
<link href="~/assets/Custom css/form-input-border.css" rel="stylesheet" />

<script src="~/assets/extra-libs/Datatables/datatables.min.js"></script>
<script src="~/dist/js/pages/datatable/datatable-basic.init.js"></script>
<script src="~/Scripts/notify.min.js"></script>
<script src="~/Scripts/Scripts.js"></script>
<script src="~/assets/libs/toastr/build/toastr.min.js"></script>
<link href="~/assets/libs/toastr/build/toastr.min.css" rel="stylesheet" />
<script src="~/assets/extra-libs/toastr/toastr-init.js"></script>
@section scripts{
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script>
        var Popup, dataTable;

        function getOne() {
            var id = document.getElementById("tlhdd").value;
            $.ajax({
                url: "/delete",
                data: JSON.stringify({ ID: id }),
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                success: function (result) {
                    dataTable.ajax.reload();
                    $.notify("Thanh lý hoàn tất", {
                        globalPosition: "top center",
                        className: "success"
                    })
                },
                error: function () {

                }
            });
        }

        $(document).ready(function () {
             $("#pre-load").show("slow", function () {
         });
        $("#pre-load").css("z-index", "99999");
            dataTable = $('#test-table')
                .on('preXhr.dt', function (e, settings, data) {
                      ////////////////////////////////////HIỆN LÊN MỖI KHI CHẠY AJAX//////////////////////////////////
      				  $("#pre-load").show("slow", function () {
      				   });
      				  $("#pre-load").css("z-index", "99999");
			          ////////////////////////////////////////////////////////////////////////
                })
                .DataTable({
                "ajax": {
                    "url": "/phong-tcld/quan-ly-nhan-vien/danh-sach-nhan-vien",
                    "type": "POST",
                    "datatype": "json",
                    "data": {
                        "MaNV": function () { return $('#searchMaNV').val() },
                        "TenNV": function () { return $('#searchTenNV').val() },
                        "Gender": function () { return $('#searchGioiTinh').val() },
                    }
                },
                "columns": [
                    {
                        "data": "MaNV", "name": "MaNV", "render": function (data) {
                            return "<a href='/phong-tcld/quan-ly-nhan-vien/xem-chi-tiet-nhan-vien?id=" + data + "' >" + data + "</a>"
                        },
                    },
                    { "data": "Ten", "name": "Ten" },
                    {
                        "data": "NgaySinh", "name": "NgaySinh", "render": function (data) {
                            return dateFormat(data);
                        }
                    },
                    {
                        "data": "GioiTinh", "name": "GioiTinh", "render": function (data) {
                            return genderFormat(data);
                        }
                    },
                    { "data": "SoDienThoai", "name": "SoDienThoai" },
                    { "data": "TenPhanXuong", "name": "TenPhanXuong" },
                    { "data": "TrangThaiLamViec", "name": "TrangThaiLamViec" },
                    {
                        "data": "MaNV", "render": function (data) {
                            return "<a class='waves-effect waves-light btn blue darken-2 btn-small' href='/phong-tcld/quan-ly-nhan-vien/chinh-sua-nhan-vien?id=" + data + "'  data-target='dropdown1'><span class='ti-pencil-alt'>&nbsp;Sửa</span></a>";

                        },
                        "orderable": false,
                        "searchable": false,
                        "width": "150px"
                    },
                    {
                        "data": "MaNV", "render": function (data) {
                            return "<a class='waves-effect waves-light btn blue darken-2 btn-small modal-trigger' data-target='history'><span class='fas fa-history'>&nbsp;Xem</span></a>";
                        },
                        "orderable": false,
                        "searchable": false,
                        "width": "150px"
                    },
                    {
                        "data": "MaNV", "render": function (data) {
                            return "<a class='waves-effect waves-light btn blue darken-2 btn-small modal-trigger' onclick='getTlhd(" + data + ")' data-target='deleteBriefs'><span class='fas fa-times-circle'>&nbsp;TLHĐ</span></a>";
                        },
                        "orderable": false,
                        "searchable": false,
                        "width": "150px"
                    }
                    ],
                "drawCallback": function (settings) {
                                 ///////////////////////ẨN SAU MỖI AJAX CALL////////////////////////
                                  $("#pre-load").hide("slow", function () {
                       		  });
 			        ////////////////////////////////////////////////
                        },
                "serverSide": "true",
                "order": [0, "asc"],
                "bLengthChange": false,
                "bFilter": false,
                "bInfo": false,
                "bAutoWidth": false,
                "initComplete": function(settings, json) {
 ////////////////////////////////////////////////ẨN KHI KHỞI TẠO TABLE XONG  ////////////////////////////////////////////////
    		$("#pre-load").hide("slow", function () {
      		  });
 //////////////////////////////////////////////// //////////////////////////////////////////////// ////////////////////////////////////////////////
  }

            });
        });

        $(document).ready(function () {
            var dataTable = $('#test-table').DataTable();
            $("#searchButton").click(function () {
               dataTable.ajax.reload(function () {
                    $.notify("Tìm kiếm thành công", {
                        globalPosition: "top center",
                        className: "success"
                    })
                });
            });
        });


        function getTlhd(a) {
            document.getElementById("tlhdd").value = a;
        }

        function sub(a) {
            var s = "form" + a;
            document.getElementById(s).SubmitForm();
        }

        function Edit(url) {
            $.post(url)
                .done(function (response) {

                });
            window.location.href = url;
        }

        function genderFormat(d) {
            if (d) {
                return "Nam";
            } else {
                return "Nữ";
            }
        }

        function dateFormat(d) {
            if (d == null) {
                return "";
            }
            var dateString = d.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            var day = currentTime.getDate();
            var year = currentTime.getFullYear();
            var date = day + "/" + month + "/" + year;
            return (date);
        }

        function SubmitForm(form) {
            $.validator.unobtrusive.parse(form);
            if ($(form).valid()) {
                $.ajax({
                    type: "POST",
                    url: form.action,
                    data: $(form).serialize(),
                    success: function (data) {
                        console.log('ahihi');
                        if (data.success) {
                            Popup.dialog('close');
                            dataTable.ajax.reload();

                            $.notify(data.message, {
                                globalPosition: "top center",
                                className: "success"
                            })

                        }
                    }
                });
            }
            return false;
        }

        $("#danhsachhosonhanvien").click(function () {
            $("#pre-load").show();
            $.ajax({
                type: "POST",
                url: "/phong-tcld/quan-ly-nhan-vien/danh-sach-nhan-vien/excel",
                cache: false
            }).done(function () {
                window.location.href = "/excel/TCLD/download/Danh_sách_nhân_viên.xlsx";
                $("#pre-load").hide();
            })
        });
    </script>
}
