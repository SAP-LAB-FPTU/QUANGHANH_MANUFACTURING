
@{
    ViewBag.Title = "NSLD";
    Layout = "~/Views/Shared/PX/_Layout_PXKT.cshtml";
}

<link href="~/assets/Custom css/PX/PXKT/ReportProduct.css" rel="stylesheet" />
<style>
    table {
        counter-reset: tableCount;
    }

    .counterCell:before {
        content: counter(tableCount);
        counter-increment: tableCount;
    }
</style>

<script>
    $(document).ready(function () {
        var url_string = window.location.href;
        var url = new URL(url_string);
        var c = url.searchParams.get("intCa");
        var time = url.searchParams.get("strDate");
        if (c == 1) {
            document.getElementById("ca").innerText = "CA 1";
        }
        if (c == 2) {
            document.getElementById("ca").innerText = "CA 2";
        }
        if (c == 3) {
            document.getElementById("ca").innerText = "CA 3";
        }
        if (time == null) {
            document.getElementById("inputdate").value = "@string.Format("{0:dd/MM/yyyy}", System.DateTime.Now)";
        } else {
            document.getElementById("inputdate").value = time;
        }

    });

</script>

<div class="card">
    <div class="card-content">
        <form>
            <div class="row center">
                <h3>
                    KHỐI LƯỢNG CÔNG VIỆC CỦA VTL1 <a class="dropdown-trigger btn" id="ca" href="#" data-target="dropdown_ca" style="background-color:#273146">CA 1</a> NGÀY <input type="text" id="inputdate" class="datepicker-here center" data-language="vi" >
                    <a class="btn waves-effect waves-light blue modal-trigger" id="btn-view" href="#" onclick="getcontent();">Xem</a>
                    <br><br>
                </h3>
                <hr>
            </div>
            <div class="row table1" style="overflow-x:auto!important">
                @if (ViewBag.nsld.Count > 0)
                {
                    <table id="" class="table table-bordered table-responsive centered highlight">
                        <thead>
                            <tr>
                                <th style="display:none;"></th>
                                <th width="3%">TT</th>
                                <th width="10%">Tên</th>
                                <th width="5%">Số thẻ</th>
                                <th width="5%">Bậc thợ</th>
                                <th width="10%">Chức danh công việc,thợ chính,thợ phụ</th>
                                <th width="10%">Nội dung công việc,vị trí làm việc</th>
                                <th width="10%">Khối lượng công việc thực hiện được</th>
                                <th width="10%">Hệ số chia lương</th>
                                <th width="10%">Lương</th>
                                <th>Dự báo nguy cơ</th>
                                <th>-Yêu cầu BPKTAT<br>-Giải pháp loại trừ nguy cơ</th>
                            </tr>
                            
                        </thead>
                        <tbody id="contentNSLD">
                            @foreach (var item in ViewBag.nsld)
                            {
                                <tr>
                                    <td style="display:none;"><input class="madiemdanh" value="@item.ID" /></td>
                                    <td class="counterCell"></td>
                                    <td>@item.Name</td>
                                    <td>@item.SoThe</td>
                                    <td>@item.BacTho</td>
                                    <td>@item.ChucDanh</td>
                                    <td>@item.NoiDungCongViec</td>
                                    <td><input type="number" value="@item.NSLD" class="form-control updateNSLD" style="border:none; text-align: center;" id="nsld"></td>
                                    <td><input type="number" value="@item.HeSoChiaLuong" class="form-control HeSoChiaLuong" style="border:none; text-align: center;" ></td>
                                    <td><input type="number" value="@item.LuongTruocDuyet" class="form-control Luong" style="border:none; text-align: center;"></td>
                                    
                                    <td><textarea class="DuBaoNguyCo">@item.DuBaoNguyCo</textarea></td>
                                    <td><textarea class="GiaiPhapNguyCo">@item.YeuCauBPKTAT</textarea></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                    <div style="margin-top:10px;">
                        <a class="btn waves-effect waves-light blue modal-trigger" id="btn-save" href="#modal1">Lưu</a>
                    </div>
                }
            </div>
           
        </form>
    </div>
</div>
<ul id='dropdown_ca' class='dropdown-content'>
    <li><a class="dropdown-child-ca" href="#" name="ca1">CA 1</a></li>
    <li><a class="dropdown-child-ca" href="#" name="ca2">CA 2</a></li>
    <li><a class="dropdown-child-ca" href="#" name="ca3">CA 3</a></li>
</ul>


<div id="modal1" class="modal">
    <div class="modal-content">
        <h3><b>Bạn có chắc chắn muốn lưu không?</b></h3>
    </div>
    <div class="modal-footer">
        <a href="#" class="modal-action modal-close waves-effect waves-green btn blue" id="btn_agrr" onclick="Update();">Lưu</a>
        <a href="javascript:void(0);" class="modal-action modal-close waves-effect waves-green btn red">Hủy</a>
    </div>
</div>

<script type="text/javascript">




    var ca;
    var intCa;
    function getInner() {
        ca = document.getElementById("ca").innerText;
        if (ca == "CA 2") {
            intCa = "2";
        }
        else if (ca == "CA 3") {
            intCa = "3";
        }
        else {
            intCa = "1";
        }
    }

    function getcontent() {

        getInner();
        window.location = "/phan-xuong-khai-thac/nang-suat-lao-dong?intCa=" + intCa + "&strDate=" + document.getElementById("inputdate").value;
    }
    function Update() {
        $('#pre-load').show();
        getInner();
        var MaDiemDanh = document.getElementsByClassName("madiemdanh");
        var NangSuatLaoDong = document.getElementsByClassName("updateNSLD");
        var HeSoChiaLuong = document.getElementsByClassName("HeSoChiaLuong");
        var Luong = document.getElementsByClassName("Luong");
        var DuBaoNguyCo = document.getElementsByClassName("DuBaoNguyCo");
        var GiaiPhapNguyCo = document.getElementsByClassName("GiaiPhapNguyCo");
        var MaDiemDanhs = [];
        var NangSuatLaoDongs = [];
        var HeSoChiaLuongs = [];
        var Luongs = [];
        var DuBaoNguyCos = [];
        var GiaiPhapNguyCos = [];
        for (var i = 0; i < MaDiemDanh.length; i++) {
            var tmpMaDiemDanh = MaDiemDanh[i].value;
            var tmpNangSuatLaoDong = NangSuatLaoDong[i].value;
            var tmpHeSoChiaLuong = HeSoChiaLuong[i].value;
            var tmpLuong = Luong[i].value;
            var tmpDuBaoNguyCo = DuBaoNguyCo[i].value;
            var tmpGiaiPhapNguyCo = GiaiPhapNguyCo[i].value;
            MaDiemDanhs.push(tmpMaDiemDanh);
            NangSuatLaoDongs.push(tmpNangSuatLaoDong);
            HeSoChiaLuongs.push(tmpHeSoChiaLuong);
            Luongs.push(tmpLuong);
            DuBaoNguyCos.push(tmpDuBaoNguyCo);
            GiaiPhapNguyCos.push(tmpGiaiPhapNguyCo);
        }
        var empObj = {
            intCa: intCa,
            MaDiemDanhs: MaDiemDanhs,
            NangSuatLaoDongs: NangSuatLaoDongs,
            HeSoChiaLuongs: HeSoChiaLuongs,
            Luongs: Luongs,
            DuBaoNguyCos: DuBaoNguyCos,
            GiaiPhapNguyCos: GiaiPhapNguyCos,
            date: document.getElementById("inputdate").value
        };
        $.ajax({
            url: "/phan-xuong-khai-thac/nang-suat-lao-dong-update",
            data: JSON.stringify(empObj),
            contentType: "application/json;charset=utf-8",
            type: "POST",
            success: function () {

                window.location = "/phan-xuong-khai-thac/nang-suat-lao-dong?intCa=" + intCa + "&strDate=" + document.getElementById("inputdate").value;
            },
            error: function () {
            }
        });
    }
</script>
<script>
    $('#inputdate').datepicker({
        language: 'vi',
        maxDate: new Date() // Now can select only dates, which goes after today
    })
    $(document).ready(function () {
        $('.datepicker-inline').remove();
    });
    $(document).ready(function () {
        $("#type").html("Xem Theo Ngày");
    });
</script>

<script src="~/js/Custom JS/button_watch_by.js"></script>


