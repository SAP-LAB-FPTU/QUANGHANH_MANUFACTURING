@model IEnumerable<QUANGHANH2.Models.Documentary>

@{
    ViewData["Title"] = "cap-nhat-thiet-bi";
    if (Session["departID"].ToString().Contains("PX"))
    {
        Layout = "~/Views/Shared/_Layout_PhanXuong.cshtml";
    }
    else
    {
        Layout = "~/Views/Shared/_Layout_CDVT.cshtml";
    }
}

    <link href="~/assets/sweetalert/sweetalert2.min.css" rel="stylesheet" />
<link href="~/assets/Custom css/CDVT/TABLE_BORDERED.css" rel="stylesheet" />
<link href="~/lib/datepicker_src/dist/css/datepicker.min.css" rel="stylesheet" type="text/css">
<link href="~/lib/datepicker_src/dist/css/datepicker.min.css " rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/custom.css " rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/font.css" rel="stylesheet" type="text/css">
<script src="~/lib/datepicker_src/dist/js/datepicker.js"></script>
<script src="~/lib/datepicker_src/dist/js/i18n/datepicker.vi.js"></script>

<div class="card">
    <div class="card-content">
        <div class="row">
            <div class="col s12">

                <div class="advanded-search">
                    <div class="row">
                        <h3 class="center"><b>DANH SÁCH THIẾT BỊ CHỜ NGHIỆM THU</b></h3>
                        <hr>
                        <div class="row center">
                            <div class="col l1 m12 s12 input-field">

                            </div>
                            <div class="col l1 m12 s12 input-field">

                            </div>
                            <div class="col l2 m12 s12 input-field">
                                <input type="text" placeholder="Tìm kiếm theo mã quyết định" id="doccumentid" class='form-control' />
                            </div>
                            <div class="col l2 m12 s12 input-field">
                                <input type="text" placeholder="Tìm kiếm theo mã tài sản cố định" id="equimentid" class='form-control' />
                            </div>
                            <div class="col l2 m12 s12 input-field">
                                <input type="text" placeholder="Tìm kiếm theo tên thiết bị" id="equimentname" class='form-control' />
                            </div>
                            <div class="col l2 m12 s12 input-field">
                                <button class="btn blue darken-2 btn-small" id="searchButton">Tìm kiếm</button>
                            </div>

                        </div>

                    </div>
                </div>

                <div class="col s12">
                    <table id="docTable" class="striped table-bordered centered responsive-table mytable">
                        <thead>
                            <tr>
                                <th rowspan="2">Quyết định số</th>
                                <th colspan="2">Thông tin thiết bị</th>
                                <th rowspan="2"></th>
                            </tr>
                            <tr>
                                <th>Mã TSCĐ</th>
                                <th>Tên thiết bị</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="thongtin" class="modal">
    <div class="modal-header center-align">
        <h3><b>Thông tin quyết định</b></h3>
    </div>
    <div class="modal-body" id="detailTable">

    </div>
</div>
<div id="vattu" class="modal">
    <div class="modal-header center card">
        <h3><b>Nghiệm thu</b></h3>
    </div>
    <div class="modal-body">
        <table id="Table" class="centered striped table-bordered">
            <tr>
                <td>Ngày nghiệm thu</td>
                <td type="datetime-local" id="datetime">
                </td>
            </tr>
        </table>
    </div>
    <div class="modal-footer">
        <a class="btn modal-close blue">Lưu</a>
        <a class="btn modal-close blue darken-2">Đóng</a>
    </div>
</div>
<div class="modal fade" id="myedit">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Sửa quyết định sửa chữa</h3>
        </div>
        <div class="modal-body">
            <form>
                <div class="row">
                    <div class="col s12 m6">
                        <div class="form-group">
                            <label for="date">Ngày : </label>
                            <input type="date" class="form-control" value="10/1/2019" />
                        </div>
                        <div class="form-group">
                            <label for="date">Người lập quyết định : </label>
                            <input type="text" class="form-control" value="Nguyễn Thị Thương" />
                        </div>
                        <div class="form-group">
                            <label for="date">Số lượng thiết bị : </label>
                            <input type="number" class="form-control" value="10" />
                        </div>

                    </div>
                    <div class="col s12 m6">
                        <div class="form-group">
                            <label for="id">Số quyết định : </label>
                            <input type="text" class="form-control" value="001" />
                        </div>
                        <div class="form-group">
                            <label for="date">Người phê duyệt quyết định : </label>
                            <input type="text" class="form-control" value="Nguyễn Văn Thái" />
                        </div>

                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn blue darken-2 modal-close save-category">Lưu</button>
            <button type="button" class="btn light-blue lighten-1 modal-close">Thoát</button>
        </div>
    </div>
</div>

<div id="myaleart" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Xác nhận lưu mục này</h3>
        </div>
        <div class="modal-body">
            <p class="red-text">Bạn có chắc chắn muốn lưu lại ?</p>
        </div>
        <div class="modal-footer">
            <a id="xacnhan" href="/phong-cdvt/cap-nhat/quyet-dinh">
                <button type="button" class="btn blue darken-2 modal-close">Xác nhận</button>
            </a>
            <button type="button" class="btn red modal-close">Hủy</button>
        </div>
    </div>
</div>

<link href="~/assets/Custom css/form-input-border.css" rel="stylesheet" />
<link href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
@section scripts{
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="~/js/advancedsearch/advancedsearch.js"></script>
    <script src="~/js/Custom JS/CDVT/Capnhat/update.js"></script>
    <script src="~/assets/sweetalert/sweetalert2.all.min.js"></script>
    <script src="~/assets/sweetalert/alert-quanghanh-js.js"></script>
    <script src="~/assets/sweetalert/sweetalert2.min.js"></script>
    <script>
        //$("#pre-load").show("slow", function () {
        // });
        //$("#pre-load").css("z-index", "99999");
        var Popup, dataTable;
        $(document).ready( function () {
            dataTable = $('#docTable').on('preXhr.dt', function (e, settings, data) {
      				  $("#pre-load").show("slow", function () {
      				   });
      				  $("#pre-load").css("z-index", "99999");
            })
                .DataTable({
                        "ajax": {
                            "url": "/phong-cdvt/nghiem-thu/search",
                            "type": "POST",
                        "datatype": "json",
                        "data": {
                            "document_code": function () { return $('#doccumentid').val() },
                            "equiment_id": function () { return $('#equimentid').val() },
                            "equiment_name": function () { return $('#equimentname').val() }
                            //"dateStart": $('#date-start-search').val(),
                            //"dateEnd": $('#date-end-search').val()
                                 },
                                },
                                "drawCallback": function (settings) {
                                  $("#pre-load").hide("slow", function () {
                       		  });

                        },
                "columns": [
                    {
                        "data": "temp", "name" : "documentary_id", "render": function (data) {
                            return "<a  class='modal-trigger' data-target='thongtin' onclick=Detail('@Url.Action("Detail","nghiemthu")?id=" + data.split("^")[0] + "')> "+data.split("^")[1]+"</a>";

                        },
                    },
                    {
                        @*"data": "equipmentId", "name" : "equipmentId", "render": function (data) {
                            //return "<td><a href='#capnhat' class='modal-trigger'>"+data+"</a></td>";
                            return "<a class='modal-trigger' onclick=GetData('@Url.Action("Index","VatTuQuyetDinh")?id=" + data + "')>" + data + "</a>";
                        },*@
                        "data": "linkIdCode", "name": "equipmentId",
                        "render": function (data) {
                            return "<a href=\"" + data.link + "?id=" + data.id + "&doc="+ data.doc +"\"> " + data.code + "</a>";
                        },
                    },

                    { "data": "equipment_name" , "name" : "equipment_name"},
                    {
                        "data": "idAndid", "render": function (data) {
                            return "<td><a class='btn blue darken-2 modal-trigger open-UpdateModal' data-equip='" + data.split("^")[0] + "' data-code='" + data.split("^")[1] + "' >Nghiệm&nbsp;thu</a></td>";
                    },
                        "orderable": false,
                        "searchable":false,
                        "width":"150px"
                    }
                    ],
                    "searching": false,
                    "bLengthChange": false,
                    "serverSide": "true",
                    "language": {
                                    emptyTable: "<li class='text-danger' align='center'>Không có dữ liệu</li>",
                                    paginate:
                                    {
                                        previous: "Trang trước",
                                        next: "Trang sau",
                                        first: "|<",
                                        last: ">|",

                                    },
                                    info: "Đang hiện _START_ đến _END_ của _TOTAL_ bản ghi",
                                    infoEmpty: "Đang hiện 0 đến 0 của 0 bản ghi",
                                },
                    "order": [0, "asc"],
                    "initComplete": function(settings, json) {
    		            $("#pre-load").hide("slow", function () {
      		              });
                    }
            });


        });


        function Detail(url) {
                $.get(url)
                .done(function (response) {
                    $("#detailTable").html(response)
                });
                return false;
        }
        function GetData(url) {
            window.location.href = url;
        }

        $(document).on("click", ".open-UpdateModal", function () {
            var equipmentId = $(this).data('equip');
            var documentary_id = $(this).data('code');
            var documentary_code = $(this).parent().parent().children().eq(0).text();
            confirmAlert(
            'Bạn có chắc chắn muốn nghiệm thu không?',
            '',
            function nghiemthu(){
                $.ajax({
                type: "POST",
                url: "/phong-cdvt/nghiem-thu/Edit",
                dataType: "json",
                success: function (data) {
                    if (data.success == true)
                        successAlert('Thành công', data.message);
                    else
                        errorAlert('Lỗi', data.message);
                    dataTable.ajax.reload()
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    errorAlert('Lỗi', 'Có lỗi xảy ra');
                },
                data: {
                    id: equipmentId,
                    documentary_code: documentary_code,
                    documentary_id: documentary_id
                },
                cache: false
            })
            });
        });

        $("#searchButton").click(function () {
            $("#pre-load").show();
            dataTable.ajax.reload(function () {
                $.notify("Tìm kiếm thành công", {
                    globalPosition: "top center",
                    className: "success"
                })
            });
        });
        $("#doccumentid").keyup(function (event) {
            if (event.keyCode === 13) {
                $("#searchButton").click();
                $("#doccumentid").blur();
            }
        });
        $("#equimentid").keyup(function (event) {
            if (event.keyCode === 13) {
                $("#searchButton").click();
                $("#equimentid").blur();
            }
        });
        $("#equimentname").keyup(function (event) {
            if (event.keyCode === 13) {
                $("#searchButton").click();
                $("#equimentname").blur();
            }
        });
    </script>
}

