@model IEnumerable<QUANGHANH2.Models.Documentary>
@{
    ViewData["Title"] = "Danghiemthu";
    Layout = "~/Views/Shared/_Layout_CDVT.cshtml";
}


<link href="~/assets/Custom css/CDVT/TABLE_BORDERED.css" rel="stylesheet" />
<link href="~/lib/datepicker_src/dist/css/datepicker.min.css" rel="stylesheet" type="text/css">
<link href="~/lib/datepicker_src/css/style.css" rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/datepicker.min.css " rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/custom.css " rel="stylesheet " type="text/css ">
<link href="~/lib/datepicker_src/dist/css/font.css" rel="stylesheet" type="text/css">
<script src="~/lib/datepicker_src/dist/js/datepicker.js"></script>
<script src="~/lib/datepicker_src/dist/js/i18n/datepicker.vi.js"></script>

<div class="card">
    <div class="card-content">
        <div class="row">
            <div class="col s12">

                <div class="advanded-search">
                    <div class="row">
                        <h3 class="center"><b>DANH SÁCH THIẾT BỊ ĐÃ NGHIỆM THU</b></h3>
                        <hr>
                        <div class="row center">
                            <div class="col l1 m12 s12 input-field">

                            </div>
                            <div class="col l2 m12 s12 input-field">
                                <i class="fas fa-calendar-alt icon"></i>
                                <input type='text' class='datepicker-here center maxDate' id="min_Date" data-language='vi' value="Ngày nhập (đi)" style="height: 24px" />
                            </div>
                            <div class="col l2 m12 s12 input-field">
                                <i class="fas fa-calendar-alt icon"></i>
                                <input type='text' class='datepicker-here center minDate' id="max_Date" data-language='vi' value="Ngày nhập (đến)" style="height: 24px" />
                            </div>
                            <div class="col l1 m12 s12 input-field">

                            </div>
                            <div class="col l2 m12 s12 input-field">
                                <input type="text" placeholder="Tìm kiếm theo mã tài sản cố định" id="equimentid" class='form-control' />
                            </div>
                            <div class="col l2 m12 s12 input-field">
                                <input type="text" placeholder="Tìm kiếm theo tên thiết bị" id="equimentname" class='form-control' />
                            </div>
                            <div class="col l2 m12 s12 input-field">
                                <button class="btn blue darken-2 btn-small" id="searchButton1">Tìm kiếm</button>
                            </div>

                        </div>

                    </div>
                </div>

                <div class="col s12">
                    <table id="docTable" class="striped table-bordered centered responsive-table mytable">
                        <thead>
                            <tr>
                                <th colspan="3">Thông tin thiết bị</th>
                                @*<th colspan="1">Thông tin nghiệm thu</th>*@
                            </tr>
                            <tr>
                                <th>Mã TSCĐ</th>
                                <th>Tên thiết bị</th>
                                <th>Ngày nghiệm thu</th>
                            </tr>
                        </thead>

                        @*<tr>
                                <td><a href="#capnhat" class="modal-trigger">AKF</a></td>
                                <td>Máy cẩu</td>
                                <td>10/2/2020</td>
                                <td>001</td>
                            </tr>*@

                    </table>
                </div>

                @*<div class="center">
                        <ul class="pagination">
                            <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                            <li class="active"><a href="#!">1</a></li>
                            <li class="waves-effect"><a href="#!">2</a></li>
                            <li class="waves-effect"><a href="#!">3</a></li>
                            <li class="waves-effect"><a href="#!">4</a></li>
                            <li class="waves-effect"><a href="#!">5</a></li>
                            <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
                        </ul>
                    </div>*@
            </div>
        </div>
    </div>
</div>
<div id="capnhat" class="modal" style="width:65% !important">
    <div class="modal-header center-align">
        <h3><b>Cập nhật sửa chữa</b></h3>
    </div>
    <div class="modal-body">
        <div class="row table_container">
            <table class="table-bordered striped table-responsive centered" style="zoom:80%;">
                <thead>
                    <tr>
                        <th rowspan="2">Số LSX, QĐ</th>
                        <th rowspan="2">Ngày tháng LSX, QĐ</th>
                        <th rowspan="2">Cấp SC</th>
                        <th colspan="2">Thời gian SC</th>
                        <th colspan="5">Chi tiết vật tư thay thế, SC</th>
                        <th rowspan="2">KQ sau SC</th>
                        <th colspan="5">Chi tiết vật tư thu hồi sau SC</th>
                    </tr>
                    <tr>
                        <th>TG vào SC</th>
                        <th>TG SC xong</th>
                        <th>Mã VT</th>
                        <th>Tên vật tư</th>
                        <th>ĐVT</th>
                        <th>Số lượng</th>
                        <th>TTKT của vật tư</th>
                        <th>Mã VT</th>
                        <th>Tên vật tư</th>
                        <th>ĐVT</th>
                        <th>Số lượng</th>
                        <th>TTKT của vật tư</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="2">1162/LSX-VQHC-CV về việc sửa chữa băng tải B650 Phân xưởng Khai thác 4</td>
                        <td rowspan="2">15/7/2019</td>
                        <td rowspan="2">
                            SCTX
                        </td>
                        <td rowspan="2">2:15AM 15/7/2019</td>
                        <td rowspan="2">4:15 AM 15/7/2019</td>
                        <td rowspan="2">KLS</td>
                        <td>Bản lề băng B650</td>
                        <td>Bộ</td>
                        <td>3</td>
                        <td>
                            <select class="form-control" style="min-width:120px">
                                <option></option>
                                <option>Mới 100%</option>
                                <option>Cũ qua sử dụng</option>
                                <option>Cũ qua sữa chữa</option>
                            </select>
                        </td>
                        <td rowspan="2">
                            <select class="form-control" style="min-width:120px">
                                <option></option>
                                <option>Đảm bảo yêu cầu kỹ thuật</option>
                                <option>Không đạt</option>
                            </select>
                        </td>
                        <td rowspan="2">KLS</td>
                        <td>Bản lề băng B650</td>
                        <td>Bộ</td>
                        <td>3</td>
                        <td>
                            <select class="form-control" style="min-width:120px">
                                <option></option>
                                <option>Hỏng - phế liệu</option>
                                <option>Cũ - tái sử dụng</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Đinh tán băng</td>
                        <td>Cái</td>
                        <td>12</td>
                        <td>
                            <select class="form-control" style="min-width:120px">
                                <option></option>
                                <option>Mới 100%</option>
                                <option>Cũ qua sử dụng</option>
                                <option>Cũ qua sữa chữa</option>
                            </select>
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>

                </tbody>
            </table>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#" class="waves-effect waves-light btn blue draken-2 modal-trigger">Thêm</a>
        <a href="#myaleart" class="waves-effect waves-light btn blue draken-2 modal-trigger">Lưu</a>
    </div>
</div>
<div id="thongtin" class="modal">
    <div class="modal-header center-align">
        <h3><b>Thông tin quyết định</b></h3>
    </div>
    <div class="modal-body">
        <div class="row">
            <table class="striped mytb">
                <tr>
                    <td>Số quyết định</td>
                    <td>019</td>
                </tr>
                <tr>
                    <td>Ngày lập quyết định</td>
                    <td>10/10/2020</td>
                </tr>
                <tr>
                    <td>Người lập quyết định</td>
                    <td>Nguyễn Văn Thái</td>
                </tr>
                <tr>
                    <td>Người phê duyệt quyết định</td>
                    <td>Trần Thị Thương</td>
                </tr>
                <tr>
                    <td>Loại quyết định</td>
                    <td>Quyết định sửa chữa</td>
                </tr>
            </table>
        </div>
    </div>
</div>
<div id="vattu" class="modal">
    <div class="modal-header center card">
        <h3><b>Nghiệm thu</b></h3>
    </div>
    <div class="modal-body">
        <table id="Table" class="centered striped table-bordered">
            <tr>
                <td>Ngày nghiệm thu</td>
                <td><input class="form-control" type="date" /></td>
            </tr>
            <tr>
                <td>Mã nghiệm thu</td>
                <td><input class="form-control" type="text" /></td>
            </tr>
        </table>
    </div>
    <div class="modal-footer">
        <a class="btn modal-close blue">Lưu</a>
        <a class="btn modal-close blue darken-2">Đóng</a>
    </div>
</div>
<div class="modal fade" id="myedit">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Sửa quyết định sửa chữa</h3>
        </div>
        <div class="modal-body">
            <form>
                <div class="row">
                    <div class="col s12 m6">
                        <div class="form-group">
                            <label for="date">Ngày : </label>
                            <input type="date" class="form-control" value="10/1/2019" />
                        </div>
                        <div class="form-group">
                            <label for="date">Người lập quyết định : </label>
                            <input type="text" class="form-control" value="Nguyễn Thị Thương" />
                        </div>
                        <div class="form-group">
                            <label for="date">Số lượng thiết bị : </label>
                            <input type="number" class="form-control" value="10" />
                        </div>

                    </div>
                    <div class="col s12 m6">
                        <div class="form-group">
                            <label for="id">Số quyết định : </label>
                            <input type="text" class="form-control" value="001" />
                        </div>
                        <div class="form-group">
                            <label for="date">Người phê duyệt quyết định : </label>
                            <input type="text" class="form-control" value="Nguyễn Văn Thái" />
                        </div>

                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="submit" class="btn blue darken-2 modal-close save-category">Lưu</button>
            <button type="button" class="btn light-blue lighten-1 modal-close">Thoát</button>
        </div>
    </div>
</div>
<div id="myaleart" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Xác nhận lưu mục này</h3>
        </div>
        <div class="modal-body">
            <p class="red-text">Bạn có chắc chắn muốn lưu lại ?</p>
        </div>
        <div class="modal-footer">
            <a id="xacnhan" href="/phong-cdvt/cap-nhat/quyet-dinh"><button type="button" class="btn blue darken-2 modal-close">Xác nhận</button></a>
            <button type="button" class="btn red modal-close">Hủy</button>
        </div>
    </div>
</div>
<script src="~/js/Custom JS/CDVT/Capnhat/update.js"></script>
<link href="~/assets/Custom css/form-input-border.css" rel="stylesheet" />
<script src="~/js/advancedsearch/advancedsearch.js"></script>
<link href="//cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
@section scripts{
    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script>
        //$("#pre-load").show("slow", function () {
        // });
        //$("#pre-load").css("z-index", "99999");
        var Popup, dataTable;

        $(document).ready(function () {
            dataTable = $('#docTable').on('preXhr.dt', function (e, settings, data) {

      				  $("#pre-load").show("slow", function () {
      				   });
      				  $("#pre-load").css("z-index", "99999");
                }).DataTable({
                "ajax": {
                    "url": "/phong-cdvt/da-nghiem-thu",
                    "type": "POST",
                    "datatype": "json",
               },
                "drawCallback": function (settings) {
                    $("#pre-load").hide("slow", function () {
                });
                },
                "columns": [
                    { "data": "equipmentId", "name": "equipmentId", "render": function (data) {
                            return "<td><a href='#capnhat' class='modal-trigger'>"+data+"</a></td>";
                        },
                    },
                    { "data": "equipment_name", "name": "equipment_name" },
                    {
                        "data": "acceptance_date", "name": "acceptance_date","render": function (data) {
                            return dateFormat(data);
                        }
                    }
                ],
                "serverSide": "true",
                                "order": [0, "asc"],
                "initComplete": function(settings, json) {
    		$("#pre-load").hide("slow", function () {
      		  });
             }
           
            });


        });

        function UpdateStatus(form) {
            $.ajax({
                type: 'POST',
                url: form.action,
                success: function (response) {
                    dataTable.ajax.reload();
                    $.notify("Cập nhật thành công", {
                        globalPosition: "top center",
                        className: "success"
                    })
                }
            });
        }
        function dateFormat(d) {
            var dateString = d.substr(6);
            var currentTime = new Date(parseInt(dateString));
            var month = currentTime.getMonth() + 1;
            var day = currentTime.getDate();
            var year = currentTime.getFullYear();
            var date = day + "/" + month + "/" + year;
            return (date);
        }

        function SubmitForm(form) {
            $.validator.unobtrusive.parse(form);
            if ($(form).valid()) {
                $.ajax({
                    type: "POST",
                    url: form.action,
                    data: $(form).serialize(),
                    success: function (data) {
                        dataTable.ajax.reload();

                        $.notify(data.message, {
                            globalPosition: "top center",
                            className: "success"
                        })

                    }
                });
            }
            return false;
        }
        function Detail(url) {
            $.get(url)
                .done(function (response) {
                    $("#detailTable").html(response)
                });
            return false;
        }
        function Update(url) {
            $.get(url)
                .done(function (response) {
                    $("#update").html(response)
                });
            return false;
        }

        function Delete(url) {
            $.get(url)
                .done(function (response) {
                    dataTable.ajax.reload();
                    $.notify("Hihi Xóa Xong", {
                        globalPosition: "top center",
                        className: "success"
                    })
                });
            return false;
        }
        //var dt = new Date();
        //document.getElementById("datetime").innerHTML = (("0" + (dt.getMonth() + 1)).slice(-2)) + "/" + (("0" + dt.getDate()).slice(-2)) + "/" + (dt.getFullYear());

       $('.maxDate').datepicker({
        language: 'vi',
        maxDate: new Date(),
        minDate: new Date("1/1/1900")
    })
    $('.minDate').datepicker({
        language: 'vi',
        maxDate: new Date() // Now can select only dates, which goes after today
    })
    $(document).ready(function () {
        $('.datepicker-inline').remove();
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!

        var yyyy = today.getFullYear();
        if (dd < 10) {
            dd = '0' + dd;
        }
        if (mm < 10) {
            mm = '0' + mm;
        }
        var today = dd + '/' + mm + '/' + yyyy;
        $(".minDate").each(function () {
            $(this).val(today);
        });
        today = new Date("1/1/1900");
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!

        var yyyy = today.getFullYear();
        if (dd < 10) {
            dd = '0' + dd;
        }
        if (mm < 10) {
            mm = '0' + mm;
        }
        var today = dd + '/' + mm + '/' + yyyy;
        $(".maxDate").val(today)
    });


        
        $("#searchButton1").click(function () {

                dataTable.destroy();
                dataTable = $('#docTable').on('preXhr.dt', function (e, settings, data) {
      				  $("#pre-load").show("slow", function () {
      				   });
      				  $("#pre-load").css("z-index", "99999");
                            }).DataTable({
                    "language": {
                        "emptyTable": "Không tìm thấy dữ liệu"
                    },
                    "ajax": {
                        "url": "/phong-cdvt/da-nghiem-thu/search",
                        "type": "POST",
                        "search": false,
                        "datatype": "json",
                        "data": {
                            "equimentid": $('#equimentid').val(),
                            "equimentname": $('#equimentname').val(),
                            "date_start": $('#min_Date').val(),
                            "date_end": $('#max_Date').val()
                        },
                        "drawCallback": function (settings) {
                                  $("#pre-load").hide("slow", function () {
                       		  });

                        },
                        "cache": false
                                },
                    
                    "columns": [
                          { "data": "equipmentId", "name": "equipment_name", "render": function (data) {
                            return "<td><a href='#capnhat' class='modal-trigger'>"+data+"</a></td>";
                        },
                    },
                    { "data": "equipment_name", "name": "equipment_name" },
                    {
                        "data": "acceptance_date", "name": "equipment_name", "render": function (data) {
                            return dateFormat(data);
                        }
                    }
                    ],
                    "serverSide": "true",
                    "order": [0, "asc"],
                    "rowId": "incident_id",
                    "lengthChange": false,
                    "searching": false,
                    "initComplete": function (settings, json) {
                        $.notify("Tìm kiếm thành công", {
                            globalPosition: "top center",
                            className: "success"
                        })
                        $("#pre-load").hide("slow", function () {
                        });
                        
                    }
                });

        });

        

    </script>
}


